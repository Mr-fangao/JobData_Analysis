{"remainingRequest":"C:\\Users\\asus\\Desktop\\GIS相关比赛\\03 计算机设计大赛(刚开始)\\03 系统运行代码\\Code\\前端\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\asus\\Desktop\\GIS相关比赛\\03 计算机设计大赛(刚开始)\\03 系统运行代码\\Code\\前端\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\asus\\Desktop\\GIS相关比赛\\03 计算机设计大赛(刚开始)\\03 系统运行代码\\Code\\前端\\src\\views\\infoSearch\\home\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\asus\\Desktop\\GIS相关比赛\\03 计算机设计大赛(刚开始)\\03 系统运行代码\\Code\\前端\\src\\views\\infoSearch\\home\\index.vue","mtime":1583737257391},{"path":"C:\\Users\\asus\\Desktop\\GIS相关比赛\\03 计算机设计大赛(刚开始)\\03 系统运行代码\\Code\\前端\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1580901136398},{"path":"C:\\Users\\asus\\Desktop\\GIS相关比赛\\03 计算机设计大赛(刚开始)\\03 系统运行代码\\Code\\前端\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\asus\\Desktop\\GIS相关比赛\\03 计算机设计大赛(刚开始)\\03 系统运行代码\\Code\\前端\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport _slicedToArray from \"C:\\\\Users\\\\asus\\\\Desktop\\\\GIS\\u76F8\\u5173\\u6BD4\\u8D5B\\\\03 \\u8BA1\\u7B97\\u673A\\u8BBE\\u8BA1\\u5927\\u8D5B(\\u521A\\u5F00\\u59CB)\\\\03 \\u7CFB\\u7EDF\\u8FD0\\u884C\\u4EE3\\u7801\\\\Code\\\\\\u524D\\u7AEF\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/slicedToArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport esriLoader from \"esri-loader\";\nimport { MapAPI } from \"@/core/config/const\";\nimport Item from \"./components/item\";\nimport Register from \"@/map/api/register\";\nimport Server from \"@/core/server\";\nimport { services } from \"@/core/config/services\";\nimport measureArea from \"@/map/components/measureArea\";\nimport measureLength from \"@/map/components/measureLength\";\nimport MapToolsView from \"@/map/components/MapToolsView\";\nimport GDrawSketch from \"@/map/api/4+/GDrawSketch\";\nimport GConvertGeometry from \"@/map/api/js/convert/GConvertGeometry\";\nimport MapLayerView from \"@/map/components/MapLayerView\";\nexport default {\n  data: function data() {\n    return {\n      loading: false,\n      visible: false,\n      isShow: false,\n      shape: \"\",\n      txt_input: \"\",\n      list: [],\n      dialog: false,\n      pageSize: 10,\n      txt_select: \"小区\",\n      data: [],\n      baseLayer: \"\",\n      street: \"\",\n      isExtent: true,\n      isPopup: true,\n      isPan: true,\n      cityList: [{\n        value: \"小区\",\n        label: \"小区\" // {\n        //   value: \"单位区\",\n        //   label: \"单位区\"\n        // }\n\n      }],\n      defaultMapExtent: \"13391592.41591351,3404268.145961022,3\",\n      spatialReference: \"\",\n      toolsUrl: \"js/json/common_tools.json\",\n      mapTileLayerLayers: \"\",\n      TileLayerStreets: \"\",\n      MapImageLayer: \"\",\n      mapview: null,\n      IsMapToolsView: false,\n      isLayerViewShow: false\n    };\n  },\n  computed: {\n    height: function height() {\n      return document.body.clientHeight - 500;\n    }\n  },\n  watch: {\n    data: function data() {\n      this.onPageChange(1);\n    }\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n\n    this.spatialReference = \"\";\n    this.addLayer(function (mapView) {\n      _this2.mapLoaded(mapView);\n    });\n    this.register(); // setTimeout(() => {\n    //   this.showGraphics();\n    // }, 600);\n  },\n  methods: {\n    onControlLayerView: function onControlLayerView() {\n      this.isLayerViewShow = !this.isLayerViewShow;\n      debugger;\n      this.$refs.layerView.showLayerView();\n    },\n    switch3d: function switch3d() {\n      this.$router.push(\"/3dmap\");\n    },\n    onClosePanel: function onClosePanel() {\n      this.visible = false;\n      this.txt_input = \"\";\n      this.data = [];\n      onemap.pubsub.publish(\"clear\");\n    },\n    register: function register() {\n      var _this3 = this;\n\n      //接收外部结果\n      onemap.pubsub.subscribe(\"showQuickSearchResult\", function (arg) {\n        _this3.isExtent = false;\n        _this3.isPan = false;\n        _this3.isPopup = arg.isPopup || true;\n        _this3.data = arg.list;\n        _this3.visible = true;\n      });\n      onemap.pubsub.subscribe(\"hideQuickSearchResult\", function (arg) {\n        _this3.visible = false;\n        _this3.data = [];\n      }); //clear\n\n      onemap.pubsub.subscribe(\"clear\", function (arg) {\n        _this3.visible = false; // this.pa;\n\n        _this3.data = [];\n      });\n    },\n    mapLoaded: function mapLoaded(mapView) {\n      new Register(mapView).mapEvent().mapAPI().parentMapAPI();\n\n      if (this.isIQuery) {\n        new GIQuery({\n          mapView: mapView,\n          isPopup: this.isIPopup\n        }).toggle();\n      }\n    },\n    onToggleLayer: function onToggleLayer() {\n      if (document.getElementsByClassName) {\n        var target = document.getElementsByClassName(\"esri-layer-list\");\n        var targetName = target[0];\n\n        if (targetName.style.display == \"block\") {\n          targetName.style.display = \"none\";\n        } else {\n          targetName.style.display = \"block\";\n        }\n      }\n    },\n    addLayer: function addLayer(callback) {\n      var _this4 = this;\n\n      esriLoader.loadScript({\n        url: MapAPI.js,\n        css: MapAPI.css\n      }).then(function (r) {\n        esriLoader.loadModules([\"esri/config\", \"esri/Map\", \"esri/layers/GroupLayer\", \"esri/Basemap\", \"esri/views/MapView\", \"esri/layers/MapImageLayer\", \"esri/layers/TileLayer\", \"esri/geometry/Extent\", \"esri/widgets/LayerList\"]).then(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 11),\n              esriConfig = _ref2[0],\n              Map = _ref2[1],\n              GroupLayer = _ref2[2],\n              Basemap = _ref2[3],\n              MapView = _ref2[4],\n              MapImageLayer = _ref2[5],\n              TileLayer = _ref2[6],\n              Extent = _ref2[7],\n              LayerList = _ref2[8],\n              dom = _ref2[9],\n              on = _ref2[10];\n\n          // esriConfig.request.corsEnabledServers.push(\"122.112.216.247/\");\n          var activeWidget = null;\n          var layer = new TileLayer({\n            url: \"http://localhost:6080/arcgis/rest/services/chouz/Map/MapServer\"\n          });\n          _this4.baseLayer = layer; // var street = new TileLayer({\n          //   url:\n          //     \"https://localhost:6443/arcgis/rest/services/ChuZhou/ChuZhouYX/MapServer\",\n          //   visible: false\n          // });\n          // this.street = street;\n          // var USALayer = new MapImageLayer({\n          //   url:\n          //     \"http://122.112.216.247:6080/arcgis/rest/services/CHUZHOU/odqllj/MapServer\",\n          //   title: \"od成本\",\n          //   visible: false\n          // });\n          // var censusLayer = new MapImageLayer({\n          //   url:\n          //     \"http://122.112.216.247:6080/arcgis/rest/services/CHUZHOU/zhonguexuequ/MapServer\",\n          //   title: \"学区数据\",\n          //   opacity: 0.8,\n          //   visible: false\n          // });\n\n          var baseMap = new Basemap({\n            baseLayers: [layer]\n          }); // var demographicGroupLayer = new GroupLayer({\n          //   title: \"专题图层\",\n          //   visible: true,\n          //   visibilityMode: \"independent\",\n          //   layers: [USALayer, censusLayer]\n          //   //\n          // });\n\n          var map = new Map({\n            basemap: baseMap // layers: [demographicGroupLayer]\n\n          });\n          var ext = String(_this4.defaultMapExtent).split(\",\");\n\n          if (ext.length > 3) {\n            console.log(\"extent 配置有误\");\n            return false;\n          }\n\n          var zoom = parseInt(ext[2]);\n          var center = {\n            x: parseFloat(ext[0]),\n            y: parseFloat(ext[1]),\n            spatialReference: _this4.spatialReference\n          };\n          _this4.mapview = new MapView({\n            container: \"viewDiv\",\n            map: map,\n            zoom: zoom,\n            center: center\n          });\n\n          _this4.mapview.ui.remove([\"attribution\", \"zoom\"]);\n\n          var view = _this4.mapview; // view.when(function() {\n          //   var layerList = new LayerList({\n          //     view: view\n          //   });\n          //   view.ui.add(layerList, \"top-right\");\n          // });\n\n          _this4.mapview.initExtent = {\n            center: center,\n            zoom: zoom\n          };\n          window.mapview = _this4.mapview;\n          callback(_this4.mapview);\n          _this4.IsMapToolsView = true;\n        });\n      });\n    },\n    switchbasemap: function switchbasemap() {\n      if (this.baseLayer.visible) {\n        this.baseLayer.visible = false;\n        this.street.visible = true;\n      } else {\n        this.baseLayer.visible = true;\n        this.street.visible = false;\n      }\n    },\n    onSearchClick: function onSearchClick() {\n      var _this5 = this;\n\n      Server.get({\n        url: services.houseQuery,\n        params: {\n          name: this.txt_input\n        }\n      }).then(function (rsp) {\n        var _this = _this5;\n\n        if (rsp.status === 1) {\n          _this.data = rsp.data;\n          _this.list = rsp.data;\n        } else {\n          _this.data = [];\n        }\n\n        _this.visible = true;\n      }, function (error) {\n        _this5.$Message.warning(error.message);\n      });\n    },\n    onPageChange: function onPageChange(page) {\n      var data = [];\n\n      for (var i = (page - 1) * this.pageSize, len = this.data.length, item; i < len, item = this.data[i]; i++) {\n        if (i < page * this.pageSize) {\n          item.pIndex = \"p\" + i;\n          data.push(item);\n        } else {\n          break;\n        }\n      }\n\n      this.list = data;\n      this.showGraphics();\n    },\n    onItemClick: function onItemClick(data) {\n      this.$emit(\"on-item-click\", data);\n      onemap.pubsub.publish(\"showQuickClick\", data); //循环定位\n\n      for (var i = 0, g; g = this.mapview.graphics.items[i]; i++) {\n        if (g.attributes.id === data.pIndex) {\n          var geometry = null;\n\n          if (g.geometry.type === \"point\") {\n            geometry = g.geometry;\n          } else {\n            var extent = g.geometry.extent.clone();\n            geometry = extent.expand(2);\n          }\n\n          this.mapview.goTo(geometry);\n          var attributes = g.attributes;\n          mapApi.popup.show({\n            mapView: this.mapview,\n            res: attributes.attr,\n            centerPt: attributes.centerPt\n          });\n          break;\n        }\n      }\n    },\n    showGraphics: function showGraphics() {\n      this.mapview.graphics.removeAll();\n      if (this.list === 0) return;\n      onemap.pubsub.publish(\"drawPolygonByList\", {\n        list: this.list,\n        extent: this.isExtent\n      });\n      onemap.pubsub.publish(\"drawMarkerByList\", {\n        list: this.list,\n        popup: this.isPopup,\n        pan: this.isPan\n      });\n    },\n    watchLayer: function watchLayer() {}\n  },\n  components: {\n    measureArea: measureArea,\n    measureLength: measureLength,\n    MapToolsView: MapToolsView,\n    Item: Item,\n    MapLayerView: MapLayerView\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA,OAAA,UAAA,MAAA,aAAA;AACA,SAAA,MAAA,QAAA,qBAAA;AACA,OAAA,IAAA,MAAA,mBAAA;AACA,OAAA,QAAA,MAAA,oBAAA;AACA,OAAA,MAAA,MAAA,eAAA;AACA,SAAA,QAAA,QAAA,wBAAA;AACA,OAAA,WAAA,MAAA,8BAAA;AACA,OAAA,aAAA,MAAA,gCAAA;AACA,OAAA,YAAA,MAAA,+BAAA;AACA,OAAA,WAAA,MAAA,0BAAA;AACA,OAAA,gBAAA,MAAA,uCAAA;AACA,OAAA,YAAA,MAAA,+BAAA;AACA,eAAA;AACA,MADA,kBACA;AACA,WAAA;AACA,eAAA,KADA;AAEA,eAAA,KAFA;AAGA,cAAA,KAHA;AAIA,aAAA,EAJA;AAKA,iBAAA,EALA;AAMA,YAAA,EANA;AAOA,cAAA,KAPA;AAQA,gBAAA,EARA;AASA,kBAAA,IATA;AAUA,YAAA,EAVA;AAWA,iBAAA,EAXA;AAYA,cAAA,EAZA;AAaA,gBAAA,IAbA;AAcA,eAAA,IAdA;AAeA,aAAA,IAfA;AAgBA,gBAAA,CACA;AACA,eAAA,IADA;AAEA,eAAA,IAFA,CAIA;AACA;AACA;AACA;;AAPA,OADA,CAhBA;AA0BA,wBAAA,uCA1BA;AA2BA,wBAAA,EA3BA;AA4BA,gBAAA,2BA5BA;AA6BA,0BAAA,EA7BA;AA8BA,wBAAA,EA9BA;AA+BA,qBAAA,EA/BA;AAgCA,eAAA,IAhCA;AAiCA,sBAAA,KAjCA;AAkCA,uBAAA;AAlCA,KAAA;AAoCA,GAtCA;AAuCA,YAAA;AACA,UADA,oBACA;AACA,aAAA,SAAA,IAAA,CAAA,YAAA,GAAA,GAAA;AACA;AAHA,GAvCA;AA4CA,SAAA;AACA,QADA,kBACA;AACA,WAAA,YAAA,CAAA,CAAA;AACA;AAHA,GA5CA;AAiDA,SAjDA,qBAiDA;AAAA;;AACA,SAAA,gBAAA,GAAA,EAAA;AACA,SAAA,QAAA,CAAA,mBAAA;AACA,aAAA,SAAA,CAAA,OAAA;AACA,KAFA;AAGA,SAAA,QAAA,GALA,CAMA;AACA;AACA;AACA,GA1DA;AA2DA,WAAA;AACA,sBADA,gCACA;AACA,WAAA,eAAA,GAAA,CAAA,KAAA,eAAA;AACA;AACA,WAAA,KAAA,CAAA,SAAA,CAAA,aAAA;AACA,KALA;AAMA,YANA,sBAMA;AACA,WAAA,OAAA,CAAA,IAAA,CAAA,QAAA;AACA,KARA;AASA,gBATA,0BASA;AACA,WAAA,OAAA,GAAA,KAAA;AACA,WAAA,SAAA,GAAA,EAAA;AACA,WAAA,IAAA,GAAA,EAAA;AACA,aAAA,MAAA,CAAA,OAAA,CAAA,OAAA;AACA,KAdA;AAeA,YAfA,sBAeA;AAAA;;AACA;AACA,aAAA,MAAA,CAAA,SAAA,CAAA,uBAAA,EAAA,eAAA;AACA,eAAA,QAAA,GAAA,KAAA;AACA,eAAA,KAAA,GAAA,KAAA;AACA,eAAA,OAAA,GAAA,IAAA,OAAA,IAAA,IAAA;AACA,eAAA,IAAA,GAAA,IAAA,IAAA;AACA,eAAA,OAAA,GAAA,IAAA;AACA,OANA;AAOA,aAAA,MAAA,CAAA,SAAA,CAAA,uBAAA,EAAA,eAAA;AACA,eAAA,OAAA,GAAA,KAAA;AACA,eAAA,IAAA,GAAA,EAAA;AACA,OAHA,EATA,CAcA;;AACA,aAAA,MAAA,CAAA,SAAA,CAAA,OAAA,EAAA,eAAA;AACA,eAAA,OAAA,GAAA,KAAA,CADA,CAEA;;AACA,eAAA,IAAA,GAAA,EAAA;AACA,OAJA;AAKA,KAnCA;AAoCA,aApCA,qBAoCA,OApCA,EAoCA;AACA,UAAA,QAAA,CAAA,OAAA,EACA,QADA,GAEA,MAFA,GAGA,YAHA;;AAIA,UAAA,KAAA,QAAA,EAAA;AACA,YAAA,OAAA,CAAA;AACA,mBAAA,OADA;AAEA,mBAAA,KAAA;AAFA,SAAA,EAGA,MAHA;AAIA;AACA,KA/CA;AAgDA,iBAhDA,2BAgDA;AACA,UAAA,SAAA,sBAAA,EAAA;AACA,YAAA,SAAA,SAAA,sBAAA,CAAA,iBAAA,CAAA;AACA,YAAA,aAAA,OAAA,CAAA,CAAA;;AACA,YAAA,WAAA,KAAA,CAAA,OAAA,IAAA,OAAA,EAAA;AACA,qBAAA,KAAA,CAAA,OAAA,GAAA,MAAA;AACA,SAFA,MAEA;AACA,qBAAA,KAAA,CAAA,OAAA,GAAA,OAAA;AACA;AACA;AACA,KA1DA;AA2DA,YA3DA,oBA2DA,QA3DA,EA2DA;AAAA;;AACA,iBACA,UADA,CACA;AACA,aAAA,OAAA,EADA;AAEA,aAAA,OAAA;AAFA,OADA,EAKA,IALA,CAKA,aAAA;AACA,mBACA,WADA,CACA,CACA,aADA,EAEA,UAFA,EAGA,wBAHA,EAIA,cAJA,EAKA,oBALA,EAMA,2BANA,EAOA,uBAPA,EAQA,sBARA,EASA,wBATA,CADA,EAYA,IAZA,CAaA,gBAYA;AAAA;AAAA,cAXA,UAWA;AAAA,cAVA,GAUA;AAAA,cATA,UASA;AAAA,cARA,OAQA;AAAA,cAPA,OAOA;AAAA,cANA,aAMA;AAAA,cALA,SAKA;AAAA,cAJA,MAIA;AAAA,cAHA,SAGA;AAAA,cAFA,GAEA;AAAA,cADA,EACA;;AACA;AAEA,cAAA,eAAA,IAAA;AAEA,cAAA,QAAA,IAAA,SAAA,CAAA;AACA,iBACA;AAFA,WAAA,CAAA;AAIA,iBAAA,SAAA,GAAA,KAAA,CATA,CAWA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,cAAA,UAAA,IAAA,OAAA,CAAA;AACA,wBAAA,CAAA,KAAA;AADA,WAAA,CAAA,CAhCA,CAmCA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,cAAA,MAAA,IAAA,GAAA,CAAA;AACA,qBAAA,OADA,CAEA;;AAFA,WAAA,CAAA;AAIA,cAAA,MAAA,OAAA,OAAA,gBAAA,EAAA,KAAA,CAAA,GAAA,CAAA;;AAEA,cAAA,IAAA,MAAA,GAAA,CAAA,EAAA;AACA,oBAAA,GAAA,CAAA,aAAA;AACA,mBAAA,KAAA;AACA;;AACA,cAAA,OAAA,SAAA,IAAA,CAAA,CAAA,CAAA;AACA,cAAA,SAAA;AACA,eAAA,WAAA,IAAA,CAAA,CAAA,CADA;AAEA,eAAA,WAAA,IAAA,CAAA,CAAA,CAFA;AAGA,8BAAA,OAAA;AAHA,WAAA;AAKA,iBAAA,OAAA,GAAA,IAAA,OAAA,CAAA;AACA,uBAAA,SADA;AAEA,iBAAA,GAFA;AAGA,kBAAA,IAHA;AAIA,oBAAA;AAJA,WAAA,CAAA;;AAMA,iBAAA,OAAA,CAAA,EAAA,CAAA,MAAA,CAAA,CAAA,aAAA,EAAA,MAAA,CAAA;;AACA,cAAA,OAAA,OAAA,OAAA,CAlEA,CAmEA;AACA;AACA;AACA;AACA;AACA;;AAEA,iBAAA,OAAA,CAAA,UAAA,GAAA;AACA,oBAAA,MADA;AAEA,kBAAA;AAFA,WAAA;AAIA,iBAAA,OAAA,GAAA,OAAA,OAAA;AACA,mBAAA,OAAA,OAAA;AACA,iBAAA,cAAA,GAAA,IAAA;AACA,SA1GA;AA4GA,OAlHA;AAmHA,KA/KA;AAgLA,iBAhLA,2BAgLA;AACA,UAAA,KAAA,SAAA,CAAA,OAAA,EAAA;AACA,aAAA,SAAA,CAAA,OAAA,GAAA,KAAA;AACA,aAAA,MAAA,CAAA,OAAA,GAAA,IAAA;AACA,OAHA,MAGA;AACA,aAAA,SAAA,CAAA,OAAA,GAAA,IAAA;AACA,aAAA,MAAA,CAAA,OAAA,GAAA,KAAA;AACA;AACA,KAxLA;AAyLA,iBAzLA,2BAyLA;AAAA;;AACA,aAAA,GAAA,CAAA;AACA,aAAA,SAAA,UADA;AAEA,gBAAA;AACA,gBAAA,KAAA;AADA;AAFA,OAAA,EAKA,IALA,CAMA,eAAA;AACA,YAAA,QAAA,MAAA;;AACA,YAAA,IAAA,MAAA,KAAA,CAAA,EAAA;AACA,gBAAA,IAAA,GAAA,IAAA,IAAA;AACA,gBAAA,IAAA,GAAA,IAAA,IAAA;AACA,SAHA,MAGA;AACA,gBAAA,IAAA,GAAA,EAAA;AACA;;AACA,cAAA,OAAA,GAAA,IAAA;AACA,OAfA,EAgBA,iBAAA;AACA,eAAA,QAAA,CAAA,OAAA,CAAA,MAAA,OAAA;AACA,OAlBA;AAoBA,KA9MA;AA+MA,gBA/MA,wBA+MA,IA/MA,EA+MA;AACA,UAAA,OAAA,EAAA;;AACA,WACA,IAAA,IAAA,CAAA,OAAA,CAAA,IAAA,KAAA,QAAA,EAAA,MAAA,KAAA,IAAA,CAAA,MAAA,EAAA,IADA,EAEA,IAAA,GAAA,EAAA,OAAA,KAAA,IAAA,CAAA,CAAA,CAFA,EAGA,GAHA,EAIA;AACA,YAAA,IAAA,OAAA,KAAA,QAAA,EAAA;AACA,eAAA,MAAA,GAAA,MAAA,CAAA;AACA,eAAA,IAAA,CAAA,IAAA;AACA,SAHA,MAGA;AACA;AACA;AACA;;AACA,WAAA,IAAA,GAAA,IAAA;AACA,WAAA,YAAA;AACA,KA/NA;AAgOA,eAhOA,uBAgOA,IAhOA,EAgOA;AACA,WAAA,KAAA,CAAA,eAAA,EAAA,IAAA;AACA,aAAA,MAAA,CAAA,OAAA,CAAA,gBAAA,EAAA,IAAA,EAFA,CAGA;;AACA,WAAA,IAAA,IAAA,CAAA,EAAA,CAAA,EAAA,IAAA,KAAA,OAAA,CAAA,QAAA,CAAA,KAAA,CAAA,CAAA,CAAA,EAAA,GAAA,EAAA;AACA,YAAA,EAAA,UAAA,CAAA,EAAA,KAAA,KAAA,MAAA,EAAA;AACA,cAAA,WAAA,IAAA;;AACA,cAAA,EAAA,QAAA,CAAA,IAAA,KAAA,OAAA,EAAA;AACA,uBAAA,EAAA,QAAA;AACA,WAFA,MAEA;AACA,gBAAA,SAAA,EAAA,QAAA,CAAA,MAAA,CAAA,KAAA,EAAA;AACA,uBAAA,OAAA,MAAA,CAAA,CAAA,CAAA;AACA;;AACA,eAAA,OAAA,CAAA,IAAA,CAAA,QAAA;AACA,cAAA,aAAA,EAAA,UAAA;AACA,iBAAA,KAAA,CAAA,IAAA,CAAA;AACA,qBAAA,KAAA,OADA;AAEA,iBAAA,WAAA,IAFA;AAGA,sBAAA,WAAA;AAHA,WAAA;AAKA;AACA;AACA;AACA,KAvPA;AAwPA,gBAxPA,0BAwPA;AACA,WAAA,OAAA,CAAA,QAAA,CAAA,SAAA;AACA,UAAA,KAAA,IAAA,KAAA,CAAA,EAAA;AACA,aAAA,MAAA,CAAA,OAAA,CAAA,mBAAA,EAAA;AACA,cAAA,KAAA,IADA;AAEA,gBAAA,KAAA;AAFA,OAAA;AAIA,aAAA,MAAA,CAAA,OAAA,CAAA,kBAAA,EAAA;AACA,cAAA,KAAA,IADA;AAEA,eAAA,KAAA,OAFA;AAGA,aAAA,KAAA;AAHA,OAAA;AAKA,KApQA;AAqQA,cArQA,wBAqQA,CAAA;AArQA,GA3DA;AAkUA,cAAA;AACA,4BADA;AAEA,gCAFA;AAGA,8BAHA;AAIA,cAJA;AAKA;AALA;AAlUA,CAAA","sourcesContent":["<template>\r\n  <div id=\"viewDiv\" region=\"center\">\r\n    <div class=\"tools\">\r\n      <MapToolsView :mapView=\"mapview\" v-if=\"IsMapToolsView\" :url=\"toolsUrl\"></MapToolsView>\r\n    </div>\r\n    <div class=\"search\">\r\n      <Dropdown trigger=\"custom\" :visible=\"visible\" style=\"width: 330px\">\r\n        <i-input v-model=\"txt_input\" icon=\"ios-search\" width=\"330px\" @on-click=\"onSearchClick\" @on-enter=\"onSearchClick\">\r\n          <i-select v-model=\"txt_select\" slot=\"prepend\" style=\"width: 80px\">\r\n            <Option value=\"小区\" label=\"小区\">\r\n              <span>小区</span>\r\n            </Option>\r\n            <!-- <Option value=\"单位区\" label=\"单位区\">\r\n              <span>单位区</span>\r\n            </Option> -->\r\n          </i-select>\r\n        </i-input>\r\n        <div class=\"close-wrapper\" @click=\"onClosePanel\">\r\n          <Tooltip content=\"清除\" placement=\"bottom\">\r\n            <span>\r\n              <i class=\"icon-empty-close\" v-if=\"!loading\"></i>\r\n              <Icon type=\"load-a\" class=\"ivu-load-loop\" size=\"20\" v-else-if=\"loading\"></Icon>\r\n            </span>\r\n          </Tooltip>\r\n        </div>\r\n        <DropdownMenu slot=\"list\">\r\n          <div class=\"wrapperBox\">\r\n            <div v-if=\"data.length===0\" class=\"message\">\r\n              <a>未找到相关信息</a>\r\n            </div>\r\n            <div class=\"list-wrapper\" :style=\"{maxHeight:height+'px'}\" v-else>\r\n              <item v-for=\"(item,id) in list\" :key=\"item.id\" :data=\"item\" :id=\"id+1\" @on-item-click=\"onItemClick\" />\r\n            </div>\r\n            <div class=\"page-footer\" v-show=\"data.length>10\">\r\n              <Page :total=\"data.length\" :page-size=\"pageSize\" size=\"small\" @on-change=\"onPageChange\"></Page>\r\n            </div>\r\n          </div>\r\n        </DropdownMenu>\r\n      </Dropdown>\r\n    </div>\r\n    <div class=\"mapbarIn\">\r\n      <ul>\r\n        <!-- <li class=\"btn\">\r\n          <span class=\"icon baseLayer\" @click=\"switch3d\"></span>\r\n          <span>3D</span>\r\n        </li>\r\n        <li id=\"switchbasemap\" @click=\"switchbasemap\">\r\n          <span class=\"icon baseLayerImg\"></span>\r\n          <span>影像</span>\r\n        </li> -->\r\n        <!-- <li class=\"btn\" @click=\"onToggleLayer\">\r\n          <span class=\"icon layerView\"></span>\r\n          <span>图层</span>\r\n        </li> -->\r\n        <!-- <map-layer-view ref=\"layerView\" style=\"margin-left:35px;\" :mapView=\"mapView\" :layerOpt=\"layerList\" :isOut=\"true\"></map-layer-view> -->\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport esriLoader from \"esri-loader\";\r\nimport { MapAPI } from \"@/core/config/const\";\r\nimport Item from \"./components/item\";\r\nimport Register from \"@/map/api/register\";\r\nimport Server from \"@/core/server\";\r\nimport { services } from \"@/core/config/services\";\r\nimport measureArea from \"@/map/components/measureArea\";\r\nimport measureLength from \"@/map/components/measureLength\";\r\nimport MapToolsView from \"@/map/components/MapToolsView\";\r\nimport GDrawSketch from \"@/map/api/4+/GDrawSketch\";\r\nimport GConvertGeometry from \"@/map/api/js/convert/GConvertGeometry\";\r\nimport MapLayerView from \"@/map/components/MapLayerView\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      visible: false,\r\n      isShow: false,\r\n      shape: \"\",\r\n      txt_input: \"\",\r\n      list: [],\r\n      dialog: false,\r\n      pageSize: 10,\r\n      txt_select: \"小区\",\r\n      data: [],\r\n      baseLayer: \"\",\r\n      street: \"\",\r\n      isExtent: true,\r\n      isPopup: true,\r\n      isPan: true,\r\n      cityList: [\r\n        {\r\n          value: \"小区\",\r\n          label: \"小区\"\r\n        }\r\n        // {\r\n        //   value: \"单位区\",\r\n        //   label: \"单位区\"\r\n        // }\r\n      ],\r\n      defaultMapExtent: \"13391592.41591351,3404268.145961022,3\",\r\n      spatialReference: \"\",\r\n      toolsUrl: \"js/json/common_tools.json\",\r\n      mapTileLayerLayers: \"\",\r\n      TileLayerStreets: \"\",\r\n      MapImageLayer: \"\",\r\n      mapview: null,\r\n      IsMapToolsView: false,\r\n      isLayerViewShow: false\r\n    };\r\n  },\r\n  computed: {\r\n    height() {\r\n      return document.body.clientHeight - 500;\r\n    }\r\n  },\r\n  watch: {\r\n    data() {\r\n      this.onPageChange(1);\r\n    }\r\n  },\r\n  mounted() {\r\n    this.spatialReference = \"\";\r\n    this.addLayer(mapView => {\r\n      this.mapLoaded(mapView);\r\n    });\r\n    this.register();\r\n    // setTimeout(() => {\r\n    //   this.showGraphics();\r\n    // }, 600);\r\n  },\r\n  methods: {\r\n    onControlLayerView() {\r\n      this.isLayerViewShow = !this.isLayerViewShow;\r\n      debugger;\r\n      this.$refs.layerView.showLayerView();\r\n    },\r\n    switch3d() {\r\n      this.$router.push(\"/3dmap\");\r\n    },\r\n    onClosePanel() {\r\n      this.visible = false;\r\n      this.txt_input = \"\";\r\n      this.data = [];\r\n      onemap.pubsub.publish(\"clear\");\r\n    },\r\n    register() {\r\n      //接收外部结果\r\n      onemap.pubsub.subscribe(\"showQuickSearchResult\", arg => {\r\n        this.isExtent = false;\r\n        this.isPan = false;\r\n        this.isPopup = arg.isPopup || true;\r\n        this.data = arg.list;\r\n        this.visible = true;\r\n      });\r\n      onemap.pubsub.subscribe(\"hideQuickSearchResult\", arg => {\r\n        this.visible = false;\r\n        this.data = [];\r\n      });\r\n\r\n      //clear\r\n      onemap.pubsub.subscribe(\"clear\", arg => {\r\n        this.visible = false;\r\n        // this.pa;\r\n        this.data = [];\r\n      });\r\n    },\r\n    mapLoaded(mapView) {\r\n      new Register(mapView)\r\n        .mapEvent()\r\n        .mapAPI()\r\n        .parentMapAPI();\r\n      if (this.isIQuery) {\r\n        new GIQuery({\r\n          mapView: mapView,\r\n          isPopup: this.isIPopup\r\n        }).toggle();\r\n      }\r\n    },\r\n    onToggleLayer() {\r\n      if (document.getElementsByClassName) {\r\n        var target = document.getElementsByClassName(\"esri-layer-list\");\r\n        var targetName = target[0];\r\n        if (targetName.style.display == \"block\") {\r\n          targetName.style.display = \"none\";\r\n        } else {\r\n          targetName.style.display = \"block\";\r\n        }\r\n      }\r\n    },\r\n    addLayer(callback) {\r\n      esriLoader\r\n        .loadScript({\r\n          url: MapAPI.js,\r\n          css: MapAPI.css\r\n        })\r\n        .then(r => {\r\n          esriLoader\r\n            .loadModules([\r\n              \"esri/config\",\r\n              \"esri/Map\",\r\n              \"esri/layers/GroupLayer\",\r\n              \"esri/Basemap\",\r\n              \"esri/views/MapView\",\r\n              \"esri/layers/MapImageLayer\",\r\n              \"esri/layers/TileLayer\",\r\n              \"esri/geometry/Extent\",\r\n              \"esri/widgets/LayerList\"\r\n            ])\r\n            .then(\r\n              ([\r\n                esriConfig,\r\n                Map,\r\n                GroupLayer,\r\n                Basemap,\r\n                MapView,\r\n                MapImageLayer,\r\n                TileLayer,\r\n                Extent,\r\n                LayerList,\r\n                dom,\r\n                on\r\n              ]) => {\r\n                // esriConfig.request.corsEnabledServers.push(\"122.112.216.247/\");\r\n\r\n                var activeWidget = null;\r\n\r\n                var layer = new TileLayer({\r\n                  url:\r\n                    \"http://localhost:6080/arcgis/rest/services/chouz/Map/MapServer\"\r\n                });\r\n                this.baseLayer = layer;\r\n\r\n                // var street = new TileLayer({\r\n                //   url:\r\n                //     \"https://localhost:6443/arcgis/rest/services/ChuZhou/ChuZhouYX/MapServer\",\r\n                //   visible: false\r\n                // });\r\n\r\n                // this.street = street;\r\n                // var USALayer = new MapImageLayer({\r\n                //   url:\r\n                //     \"http://122.112.216.247:6080/arcgis/rest/services/CHUZHOU/odqllj/MapServer\",\r\n                //   title: \"od成本\",\r\n                //   visible: false\r\n                // });\r\n\r\n                // var censusLayer = new MapImageLayer({\r\n                //   url:\r\n                //     \"http://122.112.216.247:6080/arcgis/rest/services/CHUZHOU/zhonguexuequ/MapServer\",\r\n                //   title: \"学区数据\",\r\n                //   opacity: 0.8,\r\n                //   visible: false\r\n                // });\r\n                var baseMap = new Basemap({\r\n                  baseLayers: [layer]\r\n                });\r\n                // var demographicGroupLayer = new GroupLayer({\r\n                //   title: \"专题图层\",\r\n                //   visible: true,\r\n                //   visibilityMode: \"independent\",\r\n                //   layers: [USALayer, censusLayer]\r\n                //   //\r\n                // });\r\n\r\n                var map = new Map({\r\n                  basemap: baseMap\r\n                  // layers: [demographicGroupLayer]\r\n                });\r\n                var ext = String(this.defaultMapExtent).split(\",\");\r\n\r\n                if (ext.length > 3) {\r\n                  console.log(\"extent 配置有误\");\r\n                  return false;\r\n                }\r\n                var zoom = parseInt(ext[2]);\r\n                var center = {\r\n                  x: parseFloat(ext[0]),\r\n                  y: parseFloat(ext[1]),\r\n                  spatialReference: this.spatialReference\r\n                };\r\n                this.mapview = new MapView({\r\n                  container: \"viewDiv\",\r\n                  map: map,\r\n                  zoom: zoom,\r\n                  center: center\r\n                });\r\n                this.mapview.ui.remove([\"attribution\", \"zoom\"]);\r\n                var view = this.mapview;\r\n                // view.when(function() {\r\n                //   var layerList = new LayerList({\r\n                //     view: view\r\n                //   });\r\n                //   view.ui.add(layerList, \"top-right\");\r\n                // });\r\n\r\n                this.mapview.initExtent = {\r\n                  center: center,\r\n                  zoom: zoom\r\n                };\r\n                window.mapview = this.mapview;\r\n                callback(this.mapview);\r\n                this.IsMapToolsView = true;\r\n              }\r\n            );\r\n        });\r\n    },\r\n    switchbasemap() {\r\n      if (this.baseLayer.visible) {\r\n        this.baseLayer.visible = false;\r\n        this.street.visible = true;\r\n      } else {\r\n        this.baseLayer.visible = true;\r\n        this.street.visible = false;\r\n      }\r\n    },\r\n    onSearchClick() {\r\n      Server.get({\r\n        url: services.houseQuery,\r\n        params: {\r\n          name: this.txt_input\r\n        }\r\n      }).then(\r\n        rsp => {\r\n          var _this = this;\r\n          if (rsp.status === 1) {\r\n            _this.data = rsp.data;\r\n            _this.list = rsp.data;\r\n          } else {\r\n            _this.data = [];\r\n          }\r\n          _this.visible = true;\r\n        },\r\n        error => {\r\n          this.$Message.warning(error.message);\r\n        }\r\n      );\r\n    },\r\n    onPageChange(page) {\r\n      let data = [];\r\n      for (\r\n        var i = (page - 1) * this.pageSize, len = this.data.length, item;\r\n        i < len, (item = this.data[i]);\r\n        i++\r\n      ) {\r\n        if (i < page * this.pageSize) {\r\n          item.pIndex = \"p\" + i;\r\n          data.push(item);\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      this.list = data;\r\n      this.showGraphics();\r\n    },\r\n    onItemClick(data) {\r\n      this.$emit(\"on-item-click\", data);\r\n      onemap.pubsub.publish(\"showQuickClick\", data);\r\n      //循环定位\r\n      for (var i = 0, g; (g = this.mapview.graphics.items[i]); i++) {\r\n        if (g.attributes.id === data.pIndex) {\r\n          var geometry = null;\r\n          if (g.geometry.type === \"point\") {\r\n            geometry = g.geometry;\r\n          } else {\r\n            var extent = g.geometry.extent.clone();\r\n            geometry = extent.expand(2);\r\n          }\r\n          this.mapview.goTo(geometry);\r\n          var attributes = g.attributes;\r\n          mapApi.popup.show({\r\n            mapView: this.mapview,\r\n            res: attributes.attr,\r\n            centerPt: attributes.centerPt\r\n          });\r\n          break;\r\n        }\r\n      }\r\n    },\r\n    showGraphics() {\r\n      this.mapview.graphics.removeAll();\r\n      if (this.list === 0) return;\r\n      onemap.pubsub.publish(\"drawPolygonByList\", {\r\n        list: this.list,\r\n        extent: this.isExtent\r\n      });\r\n      onemap.pubsub.publish(\"drawMarkerByList\", {\r\n        list: this.list,\r\n        popup: this.isPopup,\r\n        pan: this.isPan\r\n      });\r\n    },\r\n    watchLayer() {}\r\n  },\r\n  components: {\r\n    measureArea,\r\n    measureLength,\r\n    MapToolsView,\r\n    Item,\r\n    MapLayerView\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\">\r\n#viewDiv {\r\n  padding: 0;\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n  background: #fcf9f2;\r\n}\r\n\r\n.main .container-fluid {\r\n  padding: 0 0px;\r\n}\r\n.search {\r\n  position: absolute;\r\n  top: 2px;\r\n  left: 40px;\r\n}\r\n.wrapperBox {\r\n  position: relative;\r\n  top: 5px;\r\n}\r\n.list-wrapper {\r\n  padding: 10px;\r\n  overflow-y: auto;\r\n}\r\n.esri-layer-list__item-title {\r\n  margin-left: 5px;\r\n  padding-left: 5px;\r\n  margin-top: 5px;\r\n}\r\n\r\n#switchbasemap {\r\n  float: left;\r\n  padding: 0 10px 0 4px;\r\n  height: 30px;\r\n  line-height: 30px;\r\n  background: #ffffff;\r\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\r\n  transition: all 0.2s;\r\n  cursor: pointer;\r\n}\r\n.ivu-input-group-prepend .ivu-select-selection {\r\n  border-radius: 0;\r\n  margin: -5px -1px;\r\n  border-color: #19be6b;\r\n}\r\n.ivu-input {\r\n  border-radius: 0;\r\n  border-color: #19be6b;\r\n  padding-right: 75px;\r\n}\r\n.ivu-input-wrapper > i {\r\n  width: 40px;\r\n  font-size: 16px;\r\n  background: #19be6b;\r\n  color: white;\r\n  cursor: pointer;\r\n}\r\n.close-wrapper {\r\n  z-index: 2;\r\n  position: relative;\r\n  float: right;\r\n  top: -22px;\r\n  right: 40px;\r\n  width: 30px;\r\n  text-align: center;\r\n  border-left: 1px solid #eeeeee;\r\n  cursor: pointer;\r\n}\r\n.ivu-input-icon {\r\n  width: 32px;\r\n  height: 32px;\r\n  line-height: 32px;\r\n  font-size: 16px;\r\n  text-align: center;\r\n  color: #808695;\r\n  position: absolute;\r\n  right: 0;\r\n  z-index: 3;\r\n}\r\n/* .esri-popup--is-docked-top-right .esri-popup__main-container {\r\n  max-height: 80%;\r\n  margin-top: 40px;\r\n  margin-right: 45px;\r\n} */\r\n</style>"],"sourceRoot":"src\\views\\infoSearch\\home"}]}